# ç¬¬ä¸€èŠ‚ æ•°æ®åŠ è½½

## ä¸€ã€æ–‡æ¡£åŠ è½½å™¨

åœ¨RAGç³»ç»Ÿä¸­ï¼Œ**æ•°æ®åŠ è½½**æ˜¯æ•´ä¸ªæµæ°´çº¿çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ä¸€æ­¥ã€‚æ–‡æ¡£åŠ è½½å™¨è´Ÿè´£å°†å„ç§æ ¼å¼çš„éç»“æ„åŒ–æ–‡æ¡£ï¼ˆå¦‚PDFã€Wordã€Markdownã€HTMLç­‰ï¼‰è½¬æ¢ä¸ºç¨‹åºå¯ä»¥å¤„ç†çš„ç»“æ„åŒ–æ•°æ®ã€‚æ•°æ®åŠ è½½çš„è´¨é‡ä¼šç›´æ¥å½±å“åç»­çš„ç´¢å¼•æ„å»ºã€æ£€ç´¢æ•ˆæœå’Œæœ€ç»ˆçš„ç”Ÿæˆè´¨é‡ã€‚

### 1.1 ä¸»è¦åŠŸèƒ½

- **æ–‡æ¡£æ ¼å¼è§£æ**
å°†ä¸åŒæ ¼å¼çš„æ–‡æ¡£ï¼ˆå¦‚PDFã€Wordã€Markdownç­‰ï¼‰è§£æä¸ºæ–‡æœ¬å†…å®¹ã€‚

- **å…ƒæ•°æ®æå–**
åœ¨è§£ææ–‡æ¡£å†…å®¹çš„åŒæ—¶ï¼Œæå–ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚æ–‡æ¡£æ¥æºã€é¡µç ç­‰ã€‚

- **ç»Ÿä¸€æ•°æ®æ ¼å¼**
å°†è§£æåçš„å†…å®¹è½¬æ¢ä¸ºç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†ã€‚

### 1.2 å½“å‰ä¸»æµRAGæ–‡æ¡£åŠ è½½å™¨

| å·¥å…·åç§° | æ ¸å¿ƒç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½è¡¨ç° |
|---------|---------|---------|---------|
| **PyMuPDF4LLM** | PDFâ†’Markdownè½¬æ¢ï¼ŒOCR+è¡¨æ ¼è¯†åˆ« | ç§‘ç ”æ–‡çŒ®ã€æŠ€æœ¯æ‰‹å†Œ | å¼€æºå…è´¹ï¼ŒGPUåŠ é€Ÿ |
| **TextLoader** | åŸºç¡€æ–‡æœ¬æ–‡ä»¶åŠ è½½ | çº¯æ–‡æœ¬å¤„ç† | è½»é‡é«˜æ•ˆ |
| **DirectoryLoader** | æ‰¹é‡ç›®å½•æ–‡ä»¶å¤„ç† | æ··åˆæ ¼å¼æ–‡æ¡£åº“ | æ”¯æŒå¤šæ ¼å¼æ‰©å±• |
| **UnstructuredMarkdownLoader** | Markdownç»“æ„è§£æ | æŠ€æœ¯æ–‡æ¡£ã€åšå®¢ | ç»“æ„ä¿ç•™è‰¯å¥½ |
| **FireCrawlLoader** | ç½‘é¡µå†…å®¹æŠ“å– | åœ¨çº¿æ–‡æ¡£ã€æ–°é—» | å®æ—¶å†…å®¹è·å– |
| **LlamaParse** | æ·±åº¦PDFç»“æ„è§£æ | æ³•å¾‹åˆåŒã€å­¦æœ¯è®ºæ–‡ | è§£æç²¾åº¦é«˜ï¼Œå•†ä¸šAPI |
| **Docling** | æ¨¡å—åŒ–ä¼ä¸šçº§è§£æ | ä¼ä¸šåˆåŒã€æŠ¥å‘Š | IBMç”Ÿæ€å…¼å®¹ |
| **Marker** | PDFâ†’Markdownï¼ŒGPUåŠ é€Ÿ | ç§‘ç ”æ–‡çŒ®ã€ä¹¦ç± | ä¸“æ³¨PDFè½¬æ¢ |
| **MinerU** | å¤šæ¨¡æ€é›†æˆè§£æ | å­¦æœ¯æ–‡çŒ®ã€è´¢åŠ¡æŠ¥è¡¨ | é›†æˆLayoutLMv3+YOLOv8 |

### 1.3 æ–‡ä»¶æ ¼å¼æ”¯æŒèŒƒå›´

**ä¸»æµå·¥å…·æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼š**

- **æ–‡æœ¬æ–‡ä»¶**ï¼š`.txt`, `.md`, `.org`, `.rst`, `.csv`, `.tsv`
- **é€šç”¨æ–‡æ¡£**ï¼š`.eml`, `.html`, `.xml`
- **Microsoft Office**ï¼š`.doc`, `.docx`, `.ppt`, `.pptx`, `.xls`, `.xlsx`, `.rtf`
- **Open Document**ï¼š`.odt`, `.odp`, `.ods`
- **ç”µå­ä¹¦**ï¼š`.epub`
- **æ•°æ®æ ¼å¼**ï¼š`.json`, `.jsonl`
- **å›¾åƒ**ï¼š`.png`, `.jpeg/.jpg`, `.tiff`, `.bmp`, `.gif`
- **è‡ªå®šä¹‰æ ¼å¼**ï¼š`.custom`, `.web`

## äºŒã€Unstructuredæ–‡æ¡£å¤„ç†åº“

[**Unstructured**](https://docs.unstructured.io/open-source/) æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ–‡æ¡£å¤„ç†åº“ï¼Œä¸“é—¨è®¾è®¡ç”¨äºRAGå’ŒAIå¾®è°ƒåœºæ™¯çš„éç»“æ„åŒ–æ•°æ®é¢„å¤„ç†ã€‚æä¾›äº†ç»Ÿä¸€çš„æ¥å£æ¥å¤„ç†å¤šç§æ–‡æ¡£æ ¼å¼ï¼Œæ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„æ–‡æ¡£åŠ è½½è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚

### 2.1 Unstructuredçš„æ ¸å¿ƒä¼˜åŠ¿

ğŸš€ **æ ¼å¼æ”¯æŒå¹¿æ³›**
- æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ï¼šPDFã€Wordã€Excelã€HTMLã€Markdownç­‰
- ç»Ÿä¸€çš„APIæ¥å£ï¼Œæ— éœ€ä¸ºä¸åŒæ ¼å¼ç¼–å†™ä¸åŒä»£ç 

ğŸ“Š **æ™ºèƒ½å†…å®¹è§£æ**
- è‡ªåŠ¨è¯†åˆ«æ–‡æ¡£ç»“æ„ï¼šæ ‡é¢˜ã€æ®µè½ã€è¡¨æ ¼ã€åˆ—è¡¨ç­‰
- ä¿ç•™æ–‡æ¡£å…ƒæ•°æ®ä¿¡æ¯

### 2.2 æ”¯æŒçš„æ–‡æ¡£å…ƒç´ ç±»å‹

Unstructuredèƒ½å¤Ÿè¯†åˆ«å’Œåˆ†ç±»ä»¥ä¸‹æ–‡æ¡£å…ƒç´ ï¼š

| å…ƒç´ ç±»å‹ | æè¿° |
|---------|------|
| `Title` | æ–‡æ¡£æ ‡é¢˜ |
| `NarrativeText` | æ­£æ–‡æ®µè½ |
| `ListItem` | åˆ—è¡¨é¡¹ |
| `Table` | è¡¨æ ¼ |
| `Image` | å›¾åƒ |
| `Formula` | å…¬å¼ |

## ä¸‰ã€ä»LangChainå°è£…åˆ°åŸå§‹Unstructured

åœ¨ç¬¬ä¸€ç« çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†LangChainçš„`UnstructuredMarkdownLoader`ï¼Œå®ƒæ˜¯LangChainå¯¹Unstructuredåº“çš„å°è£…ã€‚æ¥ä¸‹æ¥å±•ç¤ºå¦‚ä½•ç›´æ¥ä½¿ç”¨Unstructuredåº“ï¼Œè¿™æ ·å¯ä»¥è·å¾—æ›´å¤§çš„çµæ´»æ€§å’Œæ§åˆ¶åŠ›ã€‚

### 3.1 å®‰è£…ä¾èµ–

```bash
cd code/C2
pip install -r requirements.txt
```

### 3.2 ä»£ç ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå°è¯•ä½¿ç”¨Unstructuredåº“åŠ è½½å¹¶è§£æä¸€ä¸ªPDFæ–‡ä»¶ï¼š

```python
from unstructured.partition.auto import partition

# PDFæ–‡ä»¶è·¯å¾„
pdf_path = "../../data/C2/pdf/rag.pdf"

# ä½¿ç”¨UnstructuredåŠ è½½å¹¶è§£æPDFæ–‡æ¡£
elements = partition(
    filename=pdf_path,
    content_type="application/pdf"
)

# æ‰“å°è§£æç»“æœ
print(f"è§£æå®Œæˆ: {len(elements)} ä¸ªå…ƒç´ , {sum(len(str(e)) for e in elements)} å­—ç¬¦")

# ç»Ÿè®¡å…ƒç´ ç±»å‹
from collections import Counter
types = Counter(e.category for e in elements)
print(f"å…ƒç´ ç±»å‹: {dict(types)}")

# æ˜¾ç¤ºæ‰€æœ‰å…ƒç´ 
print("\næ‰€æœ‰å…ƒç´ :")
for i, element in enumerate(elements, 1):
    print(f"Element {i} ({element.category}):")
    print(element)
    print("=" * 60)
```

**partitionå‡½æ•°å‚æ•°è§£æï¼š**

- `filename`: æ–‡æ¡£æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒæœ¬åœ°æ–‡ä»¶è·¯å¾„
- `content_type`: å¯é€‰å‚æ•°ï¼ŒæŒ‡å®šMIMEç±»å‹ï¼ˆå¦‚"application/pdf"ï¼‰ï¼Œå¯ç»•è¿‡è‡ªåŠ¨æ–‡ä»¶ç±»å‹æ£€æµ‹
- `file`: å¯é€‰å‚æ•°ï¼Œæ–‡ä»¶å¯¹è±¡ï¼Œä¸filenameäºŒé€‰ä¸€ä½¿ç”¨
- `url`: å¯é€‰å‚æ•°ï¼Œè¿œç¨‹æ–‡æ¡£URLï¼Œæ”¯æŒç›´æ¥å¤„ç†ç½‘ç»œæ–‡æ¡£
- `include_page_breaks`: å¸ƒå°”å€¼ï¼Œæ˜¯å¦åœ¨è¾“å‡ºä¸­åŒ…å«é¡µé¢åˆ†éš”ç¬¦
- `strategy`: å¤„ç†ç­–ç•¥ï¼Œå¯é€‰"auto"ã€"fast"ã€"hi_res"ç­‰
- `encoding`: æ–‡æœ¬ç¼–ç æ ¼å¼ï¼Œé»˜è®¤è‡ªåŠ¨æ£€æµ‹

`partition`å‡½æ•°ä½¿ç”¨è‡ªåŠ¨æ–‡ä»¶ç±»å‹æ£€æµ‹ï¼Œå†…éƒ¨ä¼šæ ¹æ®æ–‡ä»¶ç±»å‹è·¯ç”±åˆ°å¯¹åº”çš„ä¸“ç”¨å‡½æ•°ï¼ˆå¦‚PDFæ–‡ä»¶ä¼šè°ƒç”¨`partition_pdf`ï¼‰ã€‚å¦‚æœéœ€è¦æ›´ä¸“ä¸šçš„PDFå¤„ç†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨`from unstructured.partition.pdf import partition_pdf`ï¼Œå®ƒæä¾›æ›´å¤šPDFç‰¹æœ‰çš„å‚æ•°é€‰é¡¹ï¼Œå¦‚OCRè¯­è¨€è®¾ç½®ã€å›¾åƒæå–ã€è¡¨æ ¼ç»“æ„æ¨ç†ç­‰é«˜çº§åŠŸèƒ½ï¼ŒåŒæ—¶æ€§èƒ½æ›´ä¼˜ã€‚

> **å®Œæ•´ä»£ç æ–‡ä»¶**ï¼š[`code/C2/01_unstructured_example.py`](../../code/C2/01_unstructured_example.py)
> [**Unstructuredå®˜æ–¹æ–‡æ¡£**](https://docs.unstructured.io/open-source/core-functionality/partitioning)

## ç»ƒä¹ 

- ä½¿ç”¨`partition_pdf`æ›¿æ¢å½“å‰`partition`å‡½æ•°å¹¶åˆ†åˆ«å°è¯•ç”¨`hi_res`å’Œ`ocr_only`è¿›è¡Œè§£æï¼Œè§‚å¯Ÿè¾“å‡ºç»“æœæœ‰ä½•å˜åŒ–ã€‚